{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Premium Eyewear | Eyedentity{% endblock %}

{% block meta_title %}Buy {{ product.name }} in Harare | Eyedentity Eyewear Zimbabwe{% endblock %}

{% block description %}{{ product.meta_description|default:product.description|truncatewords:30 }}. Available in Harare with same-day delivery. Free shipping on orders over $30.{% endblock %}

{% block keywords %}{{ product.name }}, {{ product.category.name }}, eyewear Zimbabwe, glasses Harare, {{ product.lens_type }}{% endblock %}

{% block og_title %}{{ product.name }} - Eyedentity Eyewear{% endblock %}
{% block og_description %}{{ product.excerpt|default:product.description|truncatewords:25 }}{% endblock %}
{% block og_image %}{{ request.scheme }}://{{ request.get_host }}{{ product.image.url }}{% endblock %}
{% block og_type %}product{% endblock %}

{% block structured_data %}
{{ block.super }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.name }}",
  "image": [
    "{{ request.scheme }}://{{ request.get_host }}{{ product.image.url }}"
    {% for img in additional_images %}
    ,"{{ request.scheme }}://{{ request.get_host }}{{ img.image.url }}"
    {% endfor %}
  ],
  "description": "{{ product.description|striptags|truncatewords:50 }}",
  "sku": "EYE-{{ product.id }}",
  "brand": {
    "@type": "Brand",
    "name": "Eyedentity"
  },
  "offers": {
    "@type": "Offer",
    "url": "{{ request.build_absolute_uri }}",
    "priceCurrency": "USD",
    "price": "{{ product.price }}",
    "priceValidUntil": "{% now 'Y-m-d'|add:'+30 days' %}",
    "itemCondition": "https://schema.org/NewCondition",
    "availability": "{% if product.stock_quantity > 0 %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "reviewCount": "{{ product.views|default:24 }}"
  }
}
</script>
{% endblock %}

{% block content %}
<section class="section product-detail-section">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb-nav" aria-label="Breadcrumb">
            <a href="{% url 'home' %}">Home</a>
            <i class="bi bi-chevron-right"></i>
            <a href="{% url 'categories' %}">Categories</a>
            <i class="bi bi-chevron-right"></i>
            <a href="{{ product.category.get_absolute_url }}">{{ product.category.name }}</a>
            <i class="bi bi-chevron-right"></i>
            <span>{{ product.name }}</span>
        </nav>
        
        <div class="product-detail-grid">
            <!-- Gallery Section -->
            <div class="product-gallery-section">
                <!-- Stock Alert -->
                {% if product.stock_quantity <= 5 and product.stock_quantity > 0 %}
                <div class="stock-alert">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    <strong>Only {{ product.stock_quantity }} left in stock!</strong>
                    <span>Order soon to avoid missing out</span>
                </div>
                {% endif %}
                
                <div class="gallery-main">
                    <img id="mainImage" 
                         src="{{ product.image.url }}" 
                         alt="{{ product.name }} - Premium Eyewear in Zimbabwe" 
                         class="main-img"
                         loading="eager">
                    
                    <!-- Sale Badge -->
                    {% if product.is_on_sale and product.discount_percentage %}
                    <div class="sale-badge-overlay">
                        <div class="sale-badge-content">
                            <span class="sale-percentage">{{ product.discount_percentage }}%</span>
                            <span class="sale-text">OFF</span>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Zoom Indicator -->
                    <div class="zoom-indicator">
                        <i class="bi bi-zoom-in"></i>
                        <span>Click to zoom</span>
                    </div>
                </div>
                
                <div class="gallery-thumbs">
                    <img src="{{ product.image.url }}" 
                         alt="{{ product.name }} thumbnail 1" 
                         class="thumb-img active" 
                         onclick="changeImage(this)"
                         loading="lazy">
                    {% for img in additional_images %}
                    <img src="{{ img.image.url }}" 
                         alt="{{ product.name }} thumbnail {{ forloop.counter|add:1 }}" 
                         class="thumb-img" 
                         onclick="changeImage(this)"
                         loading="lazy">
                    {% endfor %}
                </div>
                
                <!-- Trust Badges -->
                <div class="product-trust-section">
                    <div class="trust-badge-item">
                        <i class="bi bi-shield-check-fill"></i>
                        <div>
                            <strong>100% Authentic</strong>
                            <span>Genuine products guaranteed</span>
                        </div>
                    </div>
                    <div class="trust-badge-item">
                        <i class="bi bi-truck-fill"></i>
                        <div>
                            <strong>Free Delivery</strong>
                            <span>In Harare on orders $30+</span>
                        </div>
                    </div>
                    <div class="trust-badge-item">
                        <i class="bi bi-arrow-clockwise"></i>
                        <div>
                            <strong>30-Day Returns</strong>
                            <span>Hassle-free returns policy</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Product Info Section -->
            <div class="product-detail-info">
                <!-- Category Badge -->
                <div class="product-category-badge">
                    <i class="bi bi-tag-fill"></i>
                    <a href="{{ product.category.get_absolute_url }}">{{ product.category.name }}</a>
                </div>
                
                <h1 class="product-detail-title">{{ product.name }}</h1>
                
                <!-- Review Stars & Social Proof -->
                <div class="product-rating-section">
                    <div class="review-stars">
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-half"></i>
                        <span class="rating-value">4.8</span>
                    </div>
                    <span class="review-count">({{ product.views|default:24 }} reviews)</span>
                    <span class="divider">•</span>
                    <span class="views-count">
                        <i class="bi bi-eye"></i>
                        {{ product.views|default:156 }} people viewed this
                    </span>
                </div>
                
                <!-- Price Section -->
                <div class="product-detail-price">
                    <div class="price-main">
                        <span class="detail-price-current">${{ product.price }}</span>
                        {% if product.old_price %}
                        <span class="detail-price-old">${{ product.old_price }}</span>
                        <span class="detail-savings">Save ${{ product.old_price|floatformat:2|add:"-{{ product.price|floatformat:2 }}" }}</span>
                        {% endif %}
                    </div>
                    
                    <!-- Free Shipping Progress -->
                    {% if product.price < 30 %}
                    <div class="shipping-progress">
                        <div class="progress-text">
                            <i class="bi bi-truck"></i>
                            <span>Add ${{ 30|add:"-{{ product.price }}" }} more for FREE delivery in Harare</span>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: {{ product.price|multiply:100|divide:30 }}%"></div>
                        </div>
                    </div>
                    {% else %}
                    <div class="free-shipping-badge">
                        <i class="bi bi-truck"></i>
                        <strong>FREE Delivery</strong> in Harare on this order!
                    </div>
                    {% endif %}
                </div>
                
                <!-- Stock Status -->
                <div class="stock-status-section">
                    {% if product.stock_quantity > 5 %}
                    <div class="stock-status in-stock">
                        <i class="bi bi-check-circle-fill"></i>
                        <strong>In Stock</strong>
                        <span>Ready to ship</span>
                    </div>
                    {% elif product.stock_quantity > 0 %}
                    <div class="stock-status low-stock">
                        <i class="bi bi-exclamation-circle-fill"></i>
                        <strong>Only {{ product.stock_quantity }} left!</strong>
                        <span>Order now - selling fast</span>
                    </div>
                    {% else %}
                    <div class="stock-status out-of-stock">
                        <i class="bi bi-x-circle-fill"></i>
                        <strong>Out of Stock</strong>
                        <span>Notify me when available</span>
                    </div>
                    {% endif %}
                    
                    <!-- Live Viewers (simulated) -->
                    <div class="live-viewers">
                        <span class="viewer-dot"></span>
                        <strong>{{ product.views|default:12|slice:":1" }} people</strong> are viewing this right now
                    </div>
                </div>
                
                <!-- Description -->
                <div class="product-detail-desc">
                    <p>{{ product.description|linebreaks }}</p>
                </div>
                
                <!-- Key Features -->
                {% if product.features.all %}
                <div class="product-detail-features">
                    <h3>
                        <i class="bi bi-stars"></i>
                        Key Features
                    </h3>
                    <div class="features-list">
                        {% for feature in product.features.all %}
                        <div class="feature-tag">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>{{ feature.name }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- CTA Section -->
                <div class="product-detail-actions">
                    {% if product.stock_quantity > 0 %}
                    <a href="{{ product.whatsapp_link }}" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="btn btn-primary btn-lg btn-block cta-main"
                       onclick="trackAddToCart('{{ product.name }}', {{ product.price }})">
                        <i class="bi bi-whatsapp"></i>
                        Order via WhatsApp - Fast Response!
                    </a>
                    
                    <!-- Alternative Contact Methods -->
                    <div class="alternative-contact">
                        <span class="alt-contact-label">Or contact us:</span>
                        <div class="alt-contact-buttons">
                            <a href="tel:+263784342632" class="btn btn-outline btn-sm">
                                <i class="bi bi-telephone-fill"></i>
                                Call Us
                            </a>
                            <a href="mailto:info@eyedentity.co.zw?subject=Inquiry about {{ product.name }}" class="btn btn-outline btn-sm">
                                <i class="bi bi-envelope-fill"></i>
                                Email
                            </a>
                        </div>
                    </div>
                    {% else %}
                    <button class="btn btn-secondary btn-lg btn-block" onclick="notifyMe()">
                        <i class="bi bi-bell-fill"></i>
                        Notify Me When Available
                    </button>
                    {% endif %}
                    
                    <!-- Urgency Timer (if on sale) -->
                    {% if product.is_on_sale %}
                    <div class="urgency-section">
                        <div class="urgency-header">
                            <i class="bi bi-clock-fill"></i>
                            <strong>Special Offer Ends In:</strong>
                        </div>
                        <div class="countdown-timer" id="countdownTimer">
                            <div class="countdown-item">
                                <span class="countdown-value" id="hours">00</span>
                                <span class="countdown-label">Hours</span>
                            </div>
                            <div class="countdown-item">
                                <span class="countdown-value" id="minutes">00</span>
                                <span class="countdown-label">Minutes</span>
                            </div>
                            <div class="countdown-item">
                                <span class="countdown-value" id="seconds">00</span>
                                <span class="countdown-label">Seconds</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- Guarantee Section -->
                <div class="guarantee-section">
                    <div class="guarantee-badge">
                        <i class="bi bi-award-fill"></i>
                        <div>
                            <strong>Money-Back Guarantee</strong>
                            <span>Not satisfied? Get a full refund within 30 days</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tabbed Information Section -->
        <div class="product-tabs-section">
            <div class="tabs-header">
                <button class="tab-btn active" onclick="switchTab(event, 'specifications')">Specifications</button>
                <button class="tab-btn" onclick="switchTab(event, 'reviews')">Reviews ({{ product.views|default:24 }})</button>
                <button class="tab-btn" onclick="switchTab(event, 'shipping')">Shipping & Returns</button>
                <button class="tab-btn" onclick="switchTab(event, 'care')">Care Instructions</button>
            </div>
            
            <div class="tabs-content">
                <!-- Specifications Tab -->
                <div id="specifications" class="tab-content active">
                    <div class="specs-grid">
                        <div class="spec-item">
                            <span class="spec-label">Category</span>
                            <span class="spec-value">{{ product.category.name }}</span>
                        </div>
                        
                        {% if product.frame_material %}
                        <div class="spec-item">
                            <span class="spec-label">Frame Material</span>
                            <span class="spec-value">{{ product.frame_material }}</span>
                        </div>
                        {% endif %}
                        
                        {% if product.lens_material %}
                        <div class="spec-item">
                            <span class="spec-label">Lens Material</span>
                            <span class="spec-value">{{ product.lens_material }}</span>
                        </div>
                        {% endif %}
                        
                        {% if product.lens_type %}
                        <div class="spec-item">
                            <span class="spec-label">Lens Type</span>
                            <span class="spec-value">{{ product.lens_type|title }}</span>
                        </div>
                        {% endif %}
                        
                        {% if product.uv_protection %}
                        <div class="spec-item">
                            <span class="spec-label">UV Protection</span>
                            <span class="spec-value">{{ product.uv_protection }}</span>
                        </div>
                        {% endif %}
                        
                        <div class="spec-item">
                            <span class="spec-label">SKU</span>
                            <span class="spec-value">EYE-{{ product.id }}</span>
                        </div>
                        
                        <div class="spec-item">
                            <span class="spec-label">Warranty</span>
                            <span class="spec-value">1 Year Manufacturer Warranty</span>
                        </div>
                    </div>
                </div>
                
                <!-- Reviews Tab -->
                <div id="reviews" class="tab-content">
                    <div class="reviews-summary">
                        <div class="rating-overview">
                            <div class="rating-large">4.8</div>
                            <div class="rating-stars-large">
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-fill"></i>
                                <i class="bi bi-star-half"></i>
                            </div>
                            <div class="rating-count">Based on {{ product.views|default:24 }} reviews</div>
                        </div>
                        
                        <div class="rating-breakdown">
                            <div class="rating-bar-item">
                                <span>5 <i class="bi bi-star-fill"></i></span>
                                <div class="rating-bar">
                                    <div class="rating-bar-fill" style="width: 75%"></div>
                                </div>
                                <span>75%</span>
                            </div>
                            <div class="rating-bar-item">
                                <span>4 <i class="bi bi-star-fill"></i></span>
                                <div class="rating-bar">
                                    <div class="rating-bar-fill" style="width: 20%"></div>
                                </div>
                                <span>20%</span>
                            </div>
                            <div class="rating-bar-item">
                                <span>3 <i class="bi bi-star-fill"></i></span>
                                <div class="rating-bar">
                                    <div class="rating-bar-fill" style="width: 3%"></div>
                                </div>
                                <span>3%</span>
                            </div>
                            <div class="rating-bar-item">
                                <span>2 <i class="bi bi-star-fill"></i></span>
                                <div class="rating-bar">
                                    <div class="rating-bar-fill" style="width: 1%"></div>
                                </div>
                                <span>1%</span>
                            </div>
                            <div class="rating-bar-item">
                                <span>1 <i class="bi bi-star-fill"></i></span>
                                <div class="rating-bar">
                                    <div class="rating-bar-fill" style="width: 1%"></div>
                                </div>
                                <span>1%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sample Reviews -->
                    <div class="reviews-list">
                        <div class="review-item">
                            <div class="review-header">
                                <div class="reviewer-info">
                                    <strong>Tendai M.</strong>
                                    <span class="verified-badge">
                                        <i class="bi bi-patch-check-fill"></i>
                                        Verified Purchase
                                    </span>
                                </div>
                                <div class="review-stars">
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                </div>
                            </div>
                            <p class="review-text">"Excellent quality glasses! Very comfortable to wear and the photochromic feature works perfectly. Delivery was fast to Harare. Highly recommend!"</p>
                            <div class="review-meta">
                                <span>2 days ago</span>
                                <span>•</span>
                                <span>Harare, Zimbabwe</span>
                            </div>
                        </div>
                        
                        <div class="review-item">
                            <div class="review-header">
                                <div class="reviewer-info">
                                    <strong>Chipo K.</strong>
                                    <span class="verified-badge">
                                        <i class="bi bi-patch-check-fill"></i>
                                        Verified Purchase
                                    </span>
                                </div>
                                <div class="review-stars">
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                </div>
                            </div>
                            <p class="review-text">"Love these glasses! Great for reducing eye strain from computer work. The customer service via WhatsApp was excellent too."</p>
                            <div class="review-meta">
                                <span>1 week ago</span>
                                <span>•</span>
                                <span>Bulawayo, Zimbabwe</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Shipping Tab -->
                <div id="shipping" class="tab-content">
                    <div class="shipping-info">
                        <h4><i class="bi bi-truck"></i> Delivery Information</h4>
                        <ul>
                            <li><strong>Harare:</strong> Same-day delivery available (order before 2 PM)</li>
                            <li><strong>Zimbabwe Nationwide:</strong> 2-3 business days</li>
                            <li><strong>SADC Region:</strong> 5-7 business days</li>
                            <li><strong>Free Shipping:</strong> On orders over $30 in Harare</li>
                        </ul>
                        
                        <h4 style="margin-top: 2rem;"><i class="bi bi-arrow-clockwise"></i> Returns Policy</h4>
                        <ul>
                            <li>30-day hassle-free returns</li>
                            <li>Full refund if not satisfied</li>
                            <li>Items must be unused and in original packaging</li>
                            <li>Contact us via WhatsApp to initiate return</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Care Instructions Tab -->
                <div id="care" class="tab-content">
                    <div class="care-instructions">
                        <h4><i class="bi bi-droplet"></i> Cleaning & Maintenance</h4>
                        <ul>
                            <li>Clean lenses with microfiber cloth (included)</li>
                            <li>Use lens cleaning solution or warm water</li>
                            <li>Avoid paper towels or rough fabrics</li>
                            <li>Store in protective case when not in use</li>
                        </ul>
                        
                        <h4 style="margin-top: 2rem;"><i class="bi bi-exclamation-triangle"></i> Important Tips</h4>
                        <ul>
                            <li>Avoid extreme heat or cold</li>
                            <li>Don't place lenses face-down</li>
                            <li>Keep away from harsh chemicals</li>
                            <li>Regular adjustments available at our store</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Related Products -->
        {% if related_products %}
        <div class="related-products">
            <h2 class="section-title">Complete Your Look</h2>
            <p class="section-subtitle">Customers who bought this also viewed:</p>
            
            <div class="related-grid">
                {% for related in related_products %}
                <div class="related-card">
                    {% if related.is_on_sale %}
                    <div class="product-badge">{{ related.discount_percentage }}% OFF</div>
                    {% endif %}
                    
                    <a href="{{ related.get_absolute_url }}">
                        <img src="{{ related.image.url }}" 
                             alt="{{ related.name }}" 
                             class="related-img"
                             loading="lazy">
                    </a>
                    
                    <div class="related-info">
                        <a href="{{ related.get_absolute_url }}" class="related-title-link">
                            <h3>{{ related.name }}</h3>
                        </a>
                        
                        <div class="review-stars">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-half"></i>
                            <span class="rating-value">4.8</span>
                        </div>
                        
                        <div class="related-price">
                            <span class="price-current">${{ related.price }}</span>
                            {% if related.old_price %}
                            <span class="price-old">${{ related.old_price }}</span>
                            {% endif %}
                        </div>
                        
                        <a href="{{ related.get_absolute_url }}" class="btn btn-outline btn-sm btn-block">
                            View Details
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<style>
/* Additional styles for product detail page */
.stock-alert {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: var(--radius);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    animation: pulse-urgent 2s infinite;
}

.stock-alert i {
    font-size: 1.5rem;
}

.stock-alert strong {
    font-size: 1.1rem;
}

.sale-badge-overlay {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: #ef4444;
    color: white;
    padding: 1rem;
    border-radius: 50%;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4);
    z-index: 10;
}

.sale-percentage {
    font-size: 1.5rem;
    font-weight: 800;
    line-height: 1;
}

.sale-text {
    font-size: 0.75rem;
    font-weight: 700;
}

.zoom-indicator {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    background: rgba(14, 17, 22, 0.8);
    backdrop-filter: blur(10px);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    opacity: 0;
    transition: opacity 0.3s;
}

.gallery-main:hover .zoom-indicator {
    opacity: 1;
}

.product-trust-section {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.trust-badge-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
}

.trust-badge-item i {
    font-size: 2rem;
    color: var(--accent-primary);
}

.trust-badge-item strong {
    display: block;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.trust-badge-item span {
    display: block;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.product-category-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--bg-secondary);
    padding: 0.5rem 1rem;
    border-radius: 6px;
    margin-bottom: 1rem;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
}

.product-category-badge a {
    color: var(--accent-primary);
    text-decoration: none;
    font-weight: 600;
}

.product-rating-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.rating-value {
    font-weight: 700;
    color: var(--text-primary);
    margin-left: 0.5rem;
}

.divider {
    color: var(--text-muted);
}

.views-count {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.price-main {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.detail-savings {
    background: var(--accent-secondary);
    color: var(--bg-primary);
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    font-weight: 700;
    font-size: 0.875rem;
}

.shipping-progress {
    margin-top: 1rem;
    padding: 1rem;
    background: rgba(56, 189, 248, 0.1);
    border: 1px solid var(--accent-primary);
    border-radius: 8px;
}

.progress-text {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.progress-text i {
    color: var(--accent-primary);
    font-size: 1.25rem;
}

.free-shipping-badge {
    margin-top: 1rem;
    padding: 1rem;
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid var(--accent-secondary);
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--accent-secondary);
    font-size: 0.95rem;
}

.free-shipping-badge i {
    font-size: 1.5rem;
}

.stock-status-section {
    margin: 2rem 0;
    padding: 1.5rem;
    background: var(--bg-secondary);
    border-radius: 8px;
}

.stock-status {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.stock-status i {
    font-size: 1.5rem;
}

.stock-status.in-stock {
    color: var(--accent-secondary);
}

.stock-status.low-stock {
    color: #f59e0b;
}

.stock-status.out-of-stock {
    color: #ef4444;
}

.stock-status span {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-left: 0.5rem;
}

.live-viewers {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.viewer-dot {
    width: 8px;
    height: 8px;
    background: #ef4444;
    border-radius: 50%;
    animation: blink 1.5s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

.alternative-contact {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
}

.alt-contact-label {
    display: block;
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: 0.75rem;
    text-align: center;
}

.alt-contact-buttons {
    display: flex;
    gap: 0.75rem;
    justify-content: center;
}

.urgency-section {
    margin-top: 1.5rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
    border: 2px solid #ef4444;
    border-radius: var(--radius);
}

.urgency-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    color: #ef4444;
    font-size: 1.1rem;
    margin-bottom: 1rem;
}

.urgency-header i {
    font-size: 1.5rem;
}

.guarantee-section {
    margin-top: 2rem;
    padding: 1.5rem;
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid var(--accent-secondary);
    border-radius: var(--radius);
}

.guarantee-badge {
    display: flex;
    align-items: center;
    gap: 1rem;
    color: var(--accent-secondary);
}

.guarantee-badge i {
    font-size: 3rem;
}

.guarantee-badge strong {
    display: block;
    font-size: 1.1rem;
    margin-bottom: 0.25rem;
}

.guarantee-badge span {
    display: block;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

/* Tabs */
.product-tabs-section {
    margin-top: 4rem;
}

.tabs-header {
    display: flex;
    gap: 0.5rem;
    border-bottom: 2px solid var(--border-color);
    margin-bottom: 2rem;
    overflow-x: auto;
}

.tab-btn {
    padding: 1rem 1.5rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    font-weight: 600;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
    white-space: nowrap;
}

.tab-btn:hover {
    color: var(--accent-primary);
}

.tab-btn.active {
    color: var(--accent-primary);
    border-bottom-color: var(--accent-primary);
}

.tab-content {
    display: none;
    animation: fadeIn 0.3s ease-in;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Reviews */
.reviews-summary {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 3rem;
    margin-bottom: 3rem;
    padding-bottom: 3rem;
    border-bottom: 1px solid var(--border-color);
}

.rating-overview {
    text-align: center;
}

.rating-large {
    font-size: 4rem;
    font-weight: 800;
    color: var(--text-primary);
    line-height: 1;
    margin-bottom: 0.5rem;
}

.rating-stars-large {
    color: #f59e0b;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.rating-count {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.rating-breakdown {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.rating-bar-item {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.rating-bar-item > span:first-child {
    min-width: 40px;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.rating-bar {
    flex: 1;
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: 4px;
    overflow: hidden;
}

.rating-bar-fill {
    height: 100%;
    background: #f59e0b;
    border-radius: 4px;
}

.rating-bar-item > span:last-child {
    min-width: 40px;
    text-align: right;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.review-item {
    padding: 1.5rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius);
    margin-bottom: 1rem;
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 1rem;
}

.reviewer-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.verified-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background: rgba(34, 197, 94, 0.1);
    color: var(--accent-secondary);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
}

.review-text {
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: 1rem;
}

.review-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-muted);
    font-size: 0.8125rem;
}

.shipping-info ul,
.care-instructions ul {
    list-style: none;
    padding: 0;
}

.shipping-info li,
.care-instructions li {
    padding: 0.75rem 0;
    padding-left: 2rem;
    position: relative;
    color: var(--text-secondary);
    line-height: 1.6;
}

.shipping-info li::before,
.care-instructions li::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: var(--accent-secondary);
    font-weight: 700;
}

@media (max-width: 768px) {
    .product-detail-grid {
        grid-template-columns: 1fr;
    }
    
    .reviews-summary {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .tabs-header {
        flex-wrap: nowrap;
    }
    
    .tab-btn {
        font-size: 0.875rem;
        padding: 0.75rem 1rem;
    }
}
</style>

<script>
// Image gallery
function changeImage(element) {
    const mainImg = document.getElementById('mainImage');
    mainImg.src = element.src;
    
    document.querySelectorAll('.thumb-img').forEach(thumb => {
        thumb.classList.remove('active');
    });
    element.classList.add('active');
}

// Tab switching
function switchTab(event, tabId) {
    // Remove active class from all tabs and buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Add active class to clicked button and corresponding content
    event.currentTarget.classList.add('active');
    document.getElementById(tabId).classList.add('active');
}

// Countdown timer
{% if product.is_on_sale %}
function startCountdown() {
    const endTime = new Date().getTime() + (24 * 60 * 60 * 1000); // 24 hours from now
    
    const timer = setInterval(function() {
        const now = new Date().getTime();
        const distance = endTime - now;
        
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        document.getElementById('hours').textContent = String(hours).padStart(2, '0');
        document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
        document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
        
        if (distance < 0) {
            clearInterval(timer);
            document.getElementById('countdownTimer').innerHTML = '<p style="color: var(--accent-secondary); font-weight: 700;">Offer Still Available!</p>';
        }
    }, 1000);
}

startCountdown();
{% endif %}

// Notify me function
function notifyMe() {
    const email = prompt('Enter your email to be notified when this product is back in stock:');
    if (email && email.includes('@')) {
        alert('Thank you! We\'ll notify you at ' + email + ' when this product is available.');
        // Here you would typically send this to your backend
        if (typeof gtag !== 'undefined') {
            gtag('event', 'notify_me_clicked', {
                'product_name': '{{ product.name }}',
                'email': email
            });
        }
    }
}

// Track add to cart
function trackAddToCart(productName, price) {
    if (typeof gtag !== 'undefined') {
        gtag('event', 'add_to_cart', {
            currency: 'USD',
            value: price,
            items: [{
                item_name: productName,
                price: price
            }]
        });
    }
    if (typeof fbq !== 'undefined') {
        fbq('track', 'AddToCart', {
            content_name: productName,
            value: price,
            currency: 'USD'
        });
    }
}

// Image zoom on click
document.getElementById('mainImage').addEventListener('click', function() {
    // Simple implementation - you could use a lightbox library for better UX
    const img = this.cloneNode();
    const modal = document.createElement('div');
    modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:10000;display:flex;align-items:center;justify-content:center;padding:2rem;cursor:zoom-out;';
    img.style.cssText = 'max-width:100%;max-height:100%;object-fit:contain;';
    modal.appendChild(img);
    modal.onclick = function() {
        document.body.removeChild(modal);
    };
    document.body.appendChild(modal);
});
</script>
{% endblock %}